# Milvus Segcore 源码分析

本目录包含了对 Milvus Segcore（核心执行引擎）的详细源码分析文档。

## 文档列表

1. **[目录结构概览](./01-目录结构概览.md)**
   - internal/core 目录组织
   - 主要模块介绍
   - 编译和测试相关

2. **[Segcore 架构概述](./02-Segcore架构概述.md)**
   - 核心概念（Collection、Segment）
   - 组件架构详解
   - 查询执行架构
   - 索引体系
   - 存储层设计

3. **[核心请求处理流程](./03-核心请求处理流程.md)**
   - 数据插入流程
   - 查询执行流程
   - 删除操作流程
   - 执行引擎详解
   - 一致性保证机制

4. **[标量索引建立过程](./04-标量索引建立过程.md)**
   - 标量索引类型
   - 索引创建流程
   - 各种索引实现详解
   - 索引持久化与加载
   - 性能优化策略

5. **[向量索引实现分析](./05-向量索引实现分析.md)**
   - 向量索引架构
   - VectorMemIndex 实现
   - 查询执行优化
   - Knowhere 集成
   - 特殊向量类型支持

6. **[数据存储和管理机制](./06-数据存储和管理机制.md)**
   - 存储架构概述
   - ChunkManager 实现
   - 数据编解码系统
   - Chunk 数据块管理
   - Binlog 二进制日志
   - 存储优化技术

## 关键概念总结

### Segment 类型
- **Growing Segment**：可写段，接收实时数据插入
- **Sealed Segment**：只读段，数据不可变，查询性能优化

### 核心流程
1. **插入**：预分配空间 → 写入数据 → 更新索引 → 确认提交
2. **查询**：解析计划 → 并行搜索 → 过滤处理 → 结果合并
3. **删除**：标记删除 → 更新删除记录 → 查询时过滤

### 索引体系
- **标量索引**：STLSort、Bitmap、Inverted、Marisa Trie
- **向量索引**：基于 Knowhere，支持 IVF、HNSW、DiskANN 等

### 存储特性
- 支持多种存储后端（本地、MinIO、云存储）
- 列式存储，支持压缩
- 内存映射（mmap）支持
- 分层缓存机制

## 学习建议

1. **入门路径**
   - 先读目录结构和架构概述，建立整体认识
   - 重点理解 Segment 的概念和生命周期
   - 学习核心请求的处理流程

2. **深入学习**
   - 研究具体的索引实现
   - 了解存储层的设计细节
   - 分析性能优化技术

3. **实践建议**
   - 运行单元测试了解具体行为
   - 使用 GDB 调试跟踪执行流程
   - 分析性能测试了解瓶颈

## 相关资源

- [Milvus 官方文档](https://milvus.io/docs)
- [Knowhere 向量索引库](https://github.com/milvus-io/knowhere)
- [Milvus GitHub 仓库](https://github.com/milvus-io/milvus)

## 注意事项

1. 本分析基于 Milvus 2.5 分支代码
2. Segcore 是 C++ 实现，上层通过 CGO 与 Go 代码交互
3. 部分实现细节可能随版本更新而变化