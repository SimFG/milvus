# Milvus Segcore 目录结构概览

## 核心目录说明

Milvus 的 segcore 是其核心执行引擎，位于 `internal/core` 目录下。以下是主要的目录结构：

### 1. src/segcore/ - Segcore 核心实现
这是 segcore 的主要实现目录，包含了段(Segment)管理的核心逻辑。

主要文件：
- `Collection.cpp/h` - Collection 相关实现
- `SegmentInterface.cpp/h` - Segment 接口定义
- `SegmentGrowingImpl.cpp/h` - Growing Segment 实现
- `SegmentSealedImpl.cpp/h` - Sealed Segment 实现
- `ChunkedSegmentSealedImpl.cpp/h` - 分块的 Sealed Segment 实现
- `InsertRecord.h` - 插入记录相关
- `DeletedRecord.h` - 删除记录相关
- `FieldIndexing.cpp/h` - 字段索引相关
- `TimestampIndex.cpp/h` - 时间戳索引

### 2. src/exec/ - 执行引擎
实现了查询执行引擎，包括表达式计算和算子执行。

主要子目录：
- `expression/` - 表达式计算，包括各种表达式类型的实现
- `operator/` - 执行算子，如过滤、向量搜索、分组等
- `Driver.cpp/h` - 执行驱动器
- `Task.cpp/h` - 任务管理

### 3. src/query/ - 查询处理
处理查询计划的生成和执行。

主要文件：
- `Plan.cpp/h` - 查询计划
- `PlanNode.cpp/h` - 计划节点
- `ExecPlanNodeVisitor.cpp/h` - 计划节点访问者模式实现
- `SearchOnGrowing.cpp/h` - 在 Growing Segment 上搜索
- `SearchOnSealed.cpp/h` - 在 Sealed Segment 上搜索
- `SearchOnIndex.cpp/h` - 基于索引的搜索

### 4. src/index/ - 索引实现
包含各种索引类型的实现。

主要文件：
- `IndexFactory.cpp/h` - 索引工厂
- `ScalarIndex.cpp/h` - 标量索引基类
- `ScalarIndexSort.cpp/h` - 排序的标量索引
- `StringIndexMarisa.cpp/h` - 字符串索引(基于 Marisa)
- `BitmapIndex.cpp/h` - 位图索引
- `InvertedIndexTantivy.cpp/h` - 倒排索引(基于 Tantivy)
- `VectorMemIndex.cpp/h` - 向量内存索引
- `VectorDiskIndex.cpp/h` - 向量磁盘索引

### 5. src/storage/ - 存储层
负责数据的持久化和读取。

主要文件：
- `ChunkManager.cpp/h` - 块管理器接口
- `LocalChunkManager.cpp/h` - 本地块管理器
- `MinioChunkManager.cpp/h` - MinIO 块管理器
- `DataCodec.cpp/h` - 数据编解码
- `PayloadReader.cpp/h` - 数据读取
- `PayloadWriter.cpp/h` - 数据写入
- `BinlogReader.cpp/h` - Binlog 读取

### 6. src/common/ - 通用组件
包含各种通用的数据结构和工具类。

主要文件：
- `Schema.cpp/h` - Schema 定义
- `FieldMeta.cpp/h` - 字段元信息
- `Types.h` - 类型定义
- `Chunk.cpp/h` - 数据块
- `BitsetView.h` - 位集视图

### 7. include/segcore/ - C 接口
提供给上层（Go）调用的 C 接口。

主要文件：
- `collection_c.h` - Collection C 接口
- `segment_c.h` - Segment C 接口
- `plan_c.h` - 查询计划 C 接口
- `load_index_c.h` - 索引加载 C 接口

## 编译产物
- `output/lib/` - 编译生成的库文件
- `output/include/` - 对外暴露的头文件

## 测试代码
- `unittest/` - 单元测试
- `bench/` - 性能测试

## 构建相关
- `CMakeLists.txt` - CMake 构建配置
- `build.sh` - 构建脚本
- `thirdparty/` - 第三方依赖